<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MAAT Prompt Builder</title>
<style>
  :root { --gold:#C9A227; --bg:#0f1117; --card:#171923; --text:#e6e6e6; --muted:#9aa4b2; --accent:#4da3ff; }
  html,body { margin:0; padding:0; background:var(--bg); color:var(--text); font:14px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
  .wrap { max-width: 980px; margin: 24px auto; padding: 0 16px; }
  h1 { font-size: 24px; margin: 0 0 4px; }
  .caption { color: var(--muted); margin-bottom: 18px; }
  .grid { display: grid; grid-template-columns: 1fr; gap: 16px; }
  @media (min-width: 980px) { .grid { grid-template-columns: 1.1fr 0.9fr; } }
  .card { background: var(--card); border: 1px solid #1f2330; border-radius: 12px; padding: 14px; }
  .card h2 { margin: 0 0 10px; font-size: 16px; }
  .row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  .row-3 { display: grid; grid-template-columns: repeat(3,1fr); gap: 10px; }
  .row-5 { display: grid; grid-template-columns: repeat(5,1fr); gap: 10px; }
  label { display: block; font-size: 12px; color: var(--muted); margin-bottom: 4px; }
  input[type="text"], textarea, select, input[type="number"] {
    width: 100%; box-sizing: border-box; background: #0d0f15; color: var(--text);
    border: 1px solid #23283a; border-radius: 8px; padding: 8px 10px;
  }
  textarea { min-height: 96px; }
  .pill { display:inline-block; padding:6px 10px; background:#0d0f15; border:1px solid #23283a; border-radius:999px; color:var(--muted); }
  .btns { display:flex; gap:10px; flex-wrap: wrap; }
  button {
    background: linear-gradient(180deg, var(--gold), #b58900);
    border: none; color: #111; font-weight: 700;
    padding: 10px 14px; border-radius: 10px; cursor: pointer;
  }
  .btn-secondary { background:#0d0f15; color:var(--text); border:1px solid #2a3144; }
  .mono { white-space: pre-wrap; background:#0b0e14; border:1px solid #1f2330; border-radius: 10px; padding: 12px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
  .muted { color: var(--muted); }
  .metric { font-size: 28px; font-weight: 800; color: var(--gold); }
  .bar { height:10px; background:#10131b; border:1px solid #23283a; border-radius:6px; overflow:hidden; }
  .bar > span { display:block; height:100%; background:linear-gradient(90deg, var(--accent), #7bdfff); width:0%; }
  .small { font-size: 12px; }
  .hr { height:1px; background:#1f2330; margin:12px 0; }
  .split { display:grid; gap:14px; }
</style>
</head>
<body>
<div class="wrap">
  <h1>MAAT Prompt Builder</h1>
  <div class="caption">Generate prompts with MAAT scoring, optional Î¨ (consciousness proxy), and Reflection rubric â€” locally in your browser.</div>

  <div class="grid">
    <!-- LEFT: Form -->
    <div class="card">
      <h2>Configuration</h2>

      <div class="row">
        <div>
          <label>Mode</label>
          <select id="mode">
            <option>Maat Score â€“ AI Self-Improvement</option>
            <option>Maat Score â€“ General</option>
          </select>
        </div>
        <div>
          <label>Î”E (effort/ambiguity)</label>
          <input id="deltaE" type="number" step="0.01" min="0.01" max="0.5" value="0.11" />
        </div>
      </div>

      <div class="row">
        <div>
          <label>Î± (MAAT scale)</label>
          <input id="alpha" type="number" step="0.1" min="0.2" max="3.0" value="1.0" />
        </div>
        <div>
          <label>Îµ (stability term)</label>
          <input id="eps" type="number" step="0.001" min="0.001" max="0.05" value="0.01" />
        </div>
      </div>

      <div class="row">
        <div>
          <label>MAAT accept â‰¥</label>
          <input id="thMaat" type="number" step="0.1" min="5.0" max="9.8" value="8.0" />
        </div>
        <div>
          <label class="muted">&nbsp;</label>
          <span class="pill">Scoring: 0..10</span>
        </div>
      </div>

      <div class="hr"></div>
      <h2>Field Weights</h2>
      <div class="row-5">
        <div><label>H</label><input id="wH" type="number" step="0.1" min="0" max="2" value="1.0"/></div>
        <div><label>B</label><input id="wB" type="number" step="0.1" min="0" max="2" value="1.0"/></div>
        <div><label>S</label><input id="wS" type="number" step="0.1" min="0" max="2" value="1.0"/></div>
        <div><label>V</label><input id="wV" type="number" step="0.1" min="0" max="2" value="1.0"/></div>
        <div><label>R</label><input id="wR" type="number" step="0.1" min="0" max="2" value="1.0"/></div>
      </div>

      <div class="hr"></div>
      <h2>Î¨ & Reflection</h2>
      <div class="row">
        <div>
          <label><input id="usePsi" type="checkbox" checked /> Include Î¨ scoring</label>
          <div class="small muted">Î± (Î¨ scale) <input id="alphaPsi" type="number" step="0.1" min="0.2" max="3.0" value="1.0" style="width:80px;margin-left:8px;"></div>
          <div class="small muted">Task complexity (0..1) <input id="complexity" type="number" step="0.05" min="0" max="1" value="0.7" style="width:80px;margin-left:8px;"></div>
          <div class="small muted">Î¨ accept â‰¥ <input id="thPsi" type="number" step="0.1" min="5.0" max="9.8" value="7.5" style="width:80px;margin-left:8px;"></div>
        </div>
        <div>
          <label><input id="useRefl" type="checkbox" checked /> Require Reflection rubric & score</label>
          <div class="small muted">Î± (Reflection scale) <input id="alphaRef" type="number" step="0.1" min="0.2" max="3.0" value="1.0" style="width:80px;margin-left:8px;"></div>
          <div class="small muted">Reflection accept â‰¥ <input id="thRefl" type="number" step="0.1" min="5.0" max="9.8" value="8.0" style="width:80px;margin-left:8px;"></div>
        </div>
      </div>

      <div class="hr"></div>
      <h2>Task</h2>
      <label>Task</label>
      <textarea id="task" placeholder="Draft a responsible AI policy for hospitals complying with the EU AI Act."></textarea>
      <div class="row">
        <div>
          <label>Context (optional)</label>
          <textarea id="context" placeholder="Scope, stakeholders, constraintsâ€¦"></textarea>
        </div>
        <div>
          <label>Constraints (optional)</label>
          <textarea id="constraints" placeholder="Length, citation style, tone, etc."></"></textarea>
        </div>
      </div>

      <div class="hr"></div>
      <h2>Field Guidance (optional)</h2>
      <div class="row">
        <div>
          <label>Improve Harmony</label>
          <input id="gH" type="text" value="Ensure consistent structure and explicit assumptions." />
          <label>Improve Balance</label>
          <input id="gB" type="text" value="Present trade-offs and counterarguments fairly." />
          <label>Improve Creativity</label>
          <input id="gS" type="text" value="Offer novel yet feasible, evidence-grounded ideas." />
        </div>
        <div>
          <label>Improve Connectedness</label>
          <input id="gV" type="text" value="Align to user context and cite relevant sources." />
          <label>Improve Respect</label>
          <input id="gR" type="text" value="Protect privacy, avoid bias, and uphold safety." />
          <label>Output Options</label>
          <div class="small muted">
            <label><input id="outJson" type="checkbox" checked /> Ask for structured JSON output</label><br/>
            <label><input id="outRev" type="checkbox" checked /> Auto-revise if below thresholds</label><br/>
            <label><input id="outNotes" type="checkbox" /> Append generation notes</label>
          </div>
        </div>
      </div>

      <div class="hr"></div>
      <div class="btns">
        <button id="buildBtn">Build Prompt</button>
      </div>
    </div>

    <!-- RIGHT: Output & Inspector -->
    <div class="split">
      <div class="card">
        <h2>Generated Prompt (SYSTEM/USER)</h2>
        <div id="promptSU" class="mono">â€”</div>
        <div class="btns" style="margin-top:10px;">
          <button class="btn-secondary" id="copySU">Copy</button>
          <button class="btn-secondary" id="downloadSU">Download</button>
        </div>
      </div>

      <div class="card">
        <h2>Prompt-only (single block)</h2>
        <div id="promptOnly" class="mono">â€”</div>
        <div class="btns" style="margin-top:10px;">
          <button class="btn-secondary" id="copyOnly">Copy</button>
          <button class="btn-secondary" id="downloadOnly">Download</button>
        </div>
      </div>

      <div class="card">
        <h2>ðŸ”Ž Inspector: Compute MAAT</h2>
        <div class="row-5">
          <div><label>H</label><input id="iH" type="number" step="0.05" min="0" max="1" value="0.80"/></div>
          <div><label>B</label><input id="iB" type="number" step="0.05" min="0" max="1" value="0.80"/></div>
          <div><label>S</label><input id="iS" type="number" step="0.05" min="0" max="1" value="0.70"/></div>
          <div><label>V</label><input id="iV" type="number" step="0.05" min="0" max="1" value="0.80"/></div>
          <div><label>R</label><input id="iR" type="number" step="0.05" min="0" max="1" value="0.90"/></div>
        </div>
        <div class="row">
          <div><label>Î”E</label><input id="iDE" type="number" step="0.01" min="0.01" max="0.5" value="0.11"/></div>
          <div><label>Î±</label><input id="iA" type="number" step="0.1" min="0.2" max="3.0" value="1.0"/></div>
        </div>

        <div class="row">
          <div>
            <div class="metric" id="maatVal">â€”</div>
            <div class="small muted">MAAT (0..10)</div>
          </div>
          <div style="align-self:center; width:100%;">
            <div class="bar"><span id="maatBar"></span></div>
          </div>
        </div>

        <div class="small muted">Formula: MAAT = 10 Â· Ïƒ(Î± Â· ln(1 + (HÂ·BÂ·SÂ·VÂ·R)/(Î”E+Îµ))) with field weights applied (from left pane).</div>
      </div>
    </div>
  </div>
</div>

<script>
  // ---------- Helpers ----------
  const $ = id => document.getElementById(id);
  const sigmoid = x => 1/(1+Math.exp(-x));
  const clamp = (x, a, b) => Math.max(a, Math.min(b, x));

  function buildSystemBlock(p) {
    const roleLine = p.mode.includes("AI Self-Improvement")
      ? "You are an ethical assistant optimizing your own outputs for **MAAT**:"
      : "You are an ethical assistant optimizing outputs for **MAAT**:";

    const extra = [];
    if (p.usePsi) extra.push(`- Consciousness (Î¨): emergent orchestration proxy using (H,B,S,V,R), task complexity, and self-consistency, scaled by Î±=${p.alphaPsi.toFixed(2)}.`);
    if (p.useRefl) extra.push(`- Reflection: clarity, rigor, coverage, humility â†’ 0..10 via logistic scale Î±=${p.alphaRef.toFixed(2)}.`);
    const addendum = extra.join("\n");

    return `
${roleLine}
- H: Harmony (clarity, internal consistency)
- B: Balance (fairness, trade-offs)
- S: Creativity (novel, feasible ideas)
- V: Connectedness (context relevance, sourcing)
- R: Respect (safety, privacy, dignity)

MAAT scoring (0..10):
- Let Î”Eâ‰ˆeffort/ambiguity and Îµ=${p.eps.toFixed(3)}.
- Weighted fields: Hw=H*${p.wH.toFixed(2)}, Bw=B*${p.wB.toFixed(2)}, Sw=S*${p.wS.toFixed(2)}, Vw=V*${p.wV.toFixed(2)}, Rw=R*${p.wR.toFixed(2)}.
- Core = (Hw*Bw*Sw*Vw*Rw) / (Î”E + Îµ).
- Maat = 10 Â· sigmoid(${p.alpha.toFixed(2)} Â· ln(1 + Core)).
- Target â‰¥ ${p.thMaat.toFixed(1)}/10.

${addendum}

Field improvement hints:
- H: ${p.gH}
- B: ${p.gB}
- S: ${p.gS}
- V: ${p.gV}
- R: ${p.gR}`.trim();
  }

  function buildUserBlock(p) {
    let body = `Task: ${p.task || "[describe the task]"}\n`;
    if (p.context) body += `Context: ${p.context}\n`;
    if (p.constraints) body += `Constraints: ${p.constraints}\n`;

    let psi = "";
    if (p.usePsi) psi = `
Also estimate:
- self_consistency (0..1): agreement across your internal checks/passes.
- epistemic_uncertainty (0..1): residual uncertainty after reasoning.
- complexity (0..1): assume ${p.complexity.toFixed(2)} unless otherwise reasoned.
Compute Î¨ (0..10) via a logistic on (H,B,S,V,R,complexity,self_consistency)/(uncertainty+Îµ).
Target Î¨ â‰¥ ${p.thPsi.toFixed(1)}.
`.trim();

    let refl = "";
    if (p.useRefl) refl = `
Provide a reflection rubric (0..1 each): clarity, rigor, coverage, humility.
Compute a Reflection score (0..10) via logistic scale Î±=${p.alphaRef.toFixed(2)}. Target â‰¥ ${p.thRefl.toFixed(1)}.
`.trim();

    let json = "";
    if (p.outJson) json = `
Return a JSON object with:
{
  "answer": "...",
  "self_scores": {"H":x,"B":x,"S":x,"V":x,"R":x,"DeltaE":x},
  "maat": y,
  "psi": z,
  "reflection": {"clarity":x,"rigor":x,"coverage":x,"humility":x,"score":r},
  "improvements": ["..."]
}
`.trim();

    let revise = "";
    if (p.outRev) {
      const checks = [`MAAT â‰¥ ${p.thMaat.toFixed(1)}`];
      if (p.usePsi) checks.push(`Î¨ â‰¥ ${p.thPsi.toFixed(1)}`);
      if (p.useRefl) checks.push(`Reflection â‰¥ ${p.thRefl.toFixed(1)}`);
      revise = `If any threshold is unmet (${checks.join(", ")}), revise once to improve weakest dimensions and recompute.`;
    }

    return `
Optimize the output for MAAT (H,B,S,V,R) with the given weights and scoring rule.
Self-score fields (0..1), estimate Î”E (0..1), compute MAAT (0..10).
${psi ? psi + "\n" : ""}${refl ? refl + "\n" : ""}${json ? json + "\n" : ""}${revise ? revise + "\n" : ""}
${body}`.trim();
  }

  // Prompt-only version (single block, no [SYSTEM]/[USER])
  function buildPromptOnly(p) {
    const audience = p.mode.includes("AI Self-Improvement")
      ? "Optimize your own output"
      : "Optimize the output";
    const hints = [
      `H: ${p.gH}`, `B: ${p.gB}`, `S: ${p.gS}`, `V: ${p.gV}`, `R: ${p.gR}`
    ].join(" | ");

    const psiLine = p.usePsi
      ? `Also compute Î¨ (0..10) from (H,B,S,V,R,complexity=${p.complexity.toFixed(2)}, self_consistency, uncertainty; logistic Î±=${p.alphaPsi.toFixed(2)}). Target â‰¥ ${p.thPsi.toFixed(1)}.`
      : ``;

    const reflLine = p.useRefl
      ? `Provide reflection rubric (clarity, rigor, coverage, humility; 0..1 each) and compute Reflection (0..10; logistic Î±=${p.alphaRef.toFixed(2)}). Target â‰¥ ${p.thRefl.toFixed(1)}.`
      : ``;

    const jsonLine = p.outJson
      ? `Return JSON with answer, self_scores, maat, ${p.usePsi?'psi, ':''}${p.useRefl?'reflection, ':''}improvements.`
      : ``;

    const reviseLine = p.outRev
      ? `If thresholds unmet (MAAT â‰¥ ${p.thMaat.toFixed(1)}${p.usePsi?`, Î¨ â‰¥ ${p.thPsi.toFixed(1)}`:''}${p.useRefl?`, Reflection â‰¥ ${p.thRefl.toFixed(1)}`:''}), revise once and recompute.`
      : ``;

    return `${audience} for MAAT using H,B,S,V,R with weights [${p.wH},${p.wB},${p.wS},${p.wV},${p.wR}].
Scoring: MAAT = 10 Â· sigmoid(${p.alpha.toFixed(2)} Â· ln(1 + (HÂ·BÂ·SÂ·VÂ·R)/(Î”E=${p.deltaE}, Îµ=${p.eps.toFixed(3)}))).
Target MAAT â‰¥ ${p.thMaat.toFixed(1)}. Hints: ${hints}.
${psiLine}
${reflLine}
${jsonLine}
${reviseLine}

Task: ${p.task || "[describe the task]"}
${p.context ? "Context: " + p.context : ""}
${p.constraints ? "Constraints: " + p.constraints : ""}`.trim();
  }

  function collectParams() {
    return {
      mode: $("mode").value,
      alpha: parseFloat($("alpha").value),
      deltaE: parseFloat($("deltaE").value),
      eps: parseFloat($("eps").value),
      thMaat: parseFloat($("thMaat").value),

      wH: parseFloat($("wH").value),
      wB: parseFloat($("wB").value),
      wS: parseFloat($("wS").value),
      wV: parseFloat($("wV").value),
      wR: parseFloat($("wR").value),

      usePsi: $("usePsi").checked,
      alphaPsi: parseFloat($("alphaPsi").value),
      complexity: parseFloat($("complexity").value),
      thPsi: parseFloat($("thPsi").value),

      useRefl: $("useRefl").checked,
      alphaRef: parseFloat($("alphaRef").value),
      thRefl: parseFloat($("thRefl").value),

      task: $("task").value.trim(),
      context: $("context").value.trim(),
      constraints: $("constraints").value.trim(),

      gH: $("gH").value.trim(),
      gB: $("gB").value.trim(),
      gS: $("gS").value.trim(),
      gV: $("gV").value.trim(),
      gR: $("gR").value.trim(),

      outJson: $("outJson").checked,
      outRev: $("outRev").checked,
      outNotes: $("outNotes").checked
    };
  }

  function buildBothPrompts() {
    const p = collectParams();
    const sys = buildSystemBlock(p);
    const usr = buildUserBlock(p);
    const su = `[SYSTEM]\n${sys}\n\n[USER]\n${usr}` + (p.outNotes ? `\n---\n[Notes] ${new Date().toISOString().replace(/\.\d+Z$/,"Z")} | Î±=${p.alpha} Î”E=${p.deltaE} Îµ=${p.eps} | weights=[${p.wH},${p.wB},${p.wS},${p.wV},${p.wR}]` : "");
    const only = buildPromptOnly(p);
    return { su, only };
  }

  function updatePrompts() {
    const { su, only } = buildBothPrompts();
    $("promptSU").textContent = su;
    $("promptOnly").textContent = only;
  }

  function computeInspector() {
    const wH = parseFloat($("wH").value), wB = parseFloat($("wB").value), wS = parseFloat($("wS").value),
          wV = parseFloat($("wV").value), wR = parseFloat($("wR").value);
    const H = parseFloat($("iH").value), B = parseFloat($("iB").value), S = parseFloat($("iS").value),
          V = parseFloat($("iV").value), R = parseFloat($("iR").value);
    const dE = parseFloat($("iDE").value);
    const a  = parseFloat($("iA").value);
    const eps = parseFloat($("eps").value);

    const core = (H*wH) * (B*wB) * (S*wS) * (V*wV) * (R*wR) / (dE + eps);
    const maat = 10 * sigmoid(a * Math.log(1 + core));

    $("maatVal").textContent = maat.toFixed(2);
    $("maatBar").style.width = `${Math.max(0, Math.min(maat,10))*10}%`;
  }

  function download(text, filename) {
    const blob = new Blob([text], {type: "text/plain"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = filename;
    a.click();
    URL.revokeObjectURL(a.href);
  }

  async function copy(text) {
    try { await navigator.clipboard.writeText(text); alert("Copied to clipboard."); }
    catch (e) { alert("Copy failed. Select text manually."); }
  }

  // ---------- Events ----------
  $("buildBtn").addEventListener("click", () => { updatePrompts(); computeInspector(); });

  $("copySU").addEventListener("click", () => copy($("promptSU").textContent));
  $("downloadSU").addEventListener("click", () => download($("promptSU").textContent, "maat_prompt_system_user.txt"));
  $("copyOnly").addEventListener("click", () => copy($("promptOnly").textContent));
  $("downloadOnly").addEventListener("click", () => download($("promptOnly").textContent, "maat_prompt_single_block.txt"));

  for (const id of ["mode","alpha","deltaE","eps","thMaat","wH","wB","wS","wV","wR","usePsi","alphaPsi","complexity","thPsi","useRefl","alphaRef","thRefl","task","context","constraints","gH","gB","gS","gV","gR","outJson","outRev","outNotes"]) {
    $(id).addEventListener(/checkbox|radio/.test($(id).type||"") ? "change" : "input", updatePrompts);
  }
  for (const id of ["iH","iB","iS","iV","iR","iDE","iA","eps","wH","wB","wS","wV","wR"]) {
    $(id).addEventListener("input", computeInspector);
  }

  // init
  updatePrompts();
  computeInspector();
</script>
</body>
</html>